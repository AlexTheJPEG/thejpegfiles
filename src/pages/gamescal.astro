---
import BaseLayout from "../layouts/BaseLayout.astro";

const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
---

<BaseLayout title="NYTimes Games Calendar" description="Archive and statistics for my NYTimes Games results">
    <div class="text-white">
        <h1 class="text-5xl font-bold mt-20">NYTimes Games Calendar</h1>
        <p class="text-lg mt-4">An archive of and some statistics for my NYTimes Games
            (Wordle, Connections, Strands) results.</p>
        <div class="flex justify-center items-center mt-10">
            <div class="text-white">
                <div class="flex items-center justify-between px-10 py-3 bg-gray-700 rounded">
                    <button id="prevMonth" class="text-white px-10">Previous</button>
                    <div class="flex-1 flex items-center justify-center">
                        <h2 id="currentMonth"
                            class="text-white w-20 text-left">{new Date().toLocaleString('en-US', {month: 'long'})}</h2>
                        <h2 id="currentYear" class="text-white w-10 text-right">{new Date().getFullYear()}</h2>
                    </div>
                    <button id="nextMonth" class="text-white px-10">Next</button>
                </div>
            </div>
        </div>
        <div class="grid grid-cols-7 gap-4 mt-6 text-center">
            {daysOfWeek.map(day => <div class="font-bold">{day}</div>)}
        </div>
        <div id="calendar" class="grid grid-cols-7 gap-4 mt-2 text-center"/>
    </div>
</BaseLayout>

<script>
    const currentMonthElement = document.getElementById('currentMonth');
    const currentYearElement = document.getElementById('currentYear');

    // Define months array
    const months = ['January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'];

    const renderCalendar = (monthIndex: number, year: number) => {
        const firstDay = new Date(year, monthIndex, 1).getDay();

        const daysInMonth = new Date(year, monthIndex + 1, 0).getDate();
        const prevDaysInMonth = new Date(year, monthIndex, 0).getDate();

        const today = new Date();
        const isCurrentMonth = today.getFullYear() === year && today.getMonth() === monthIndex;

        const calendarElement = document.getElementById('calendar');
        if (!calendarElement) return;

        // Clear previous calendar days
        calendarElement.innerHTML = '';

        // Fill the calendar with previous month's days
        for (let i = firstDay - 1; i >= 0; i--) {
            const prevMonthDayCell = document.createElement('div');
            prevMonthDayCell.className = 'bg-gray-800 py-2 rounded'; // Dimmer background
            prevMonthDayCell.textContent = (prevDaysInMonth - i).toString();
            calendarElement.appendChild(prevMonthDayCell);
        }

        // Fill the calendar with current month's days
        for (let i = 1; i <= daysInMonth; i++) {
            const dayCell = document.createElement('div');
            dayCell.className = 'py-2 rounded';
            // Highlight the current date blue
            dayCell.className += isCurrentMonth && i === today.getDate() ? ' bg-blue-600' : ' bg-gray-600';
            dayCell.textContent = i.toString();
            calendarElement.appendChild(dayCell);
        }

        // Fill the calendar with next month's days
        const totalDisplayedDays = firstDay + daysInMonth;
        const remainingDays = totalDisplayedDays % 7 ? 7 - (totalDisplayedDays % 7) : 0;
        for (let i = 1; i <= remainingDays; i++) {
            const nextMonthDayCell = document.createElement('div');
            nextMonthDayCell.className = 'bg-gray-800 py-2 rounded'; // Dimmer background
            nextMonthDayCell.textContent = i.toString();
            calendarElement.appendChild(nextMonthDayCell);
        }
    };

    document.getElementById('nextMonth')?.addEventListener('click', () => {
        if (currentMonthElement && currentYearElement) {
            let currentMonthIndex = months.indexOf(currentMonthElement.textContent ?? '');
            let currentYear = parseInt(currentYearElement.textContent ?? '0');

            // Advance to the next month
            if (currentMonthIndex === 11) {
                currentMonthIndex = 0; // Wrap around to January
                currentYear += 1; // Advance the year
            } else {
                currentMonthIndex += 1;
            }

            // Update the DOM elements with new values
            currentMonthElement.textContent = months[currentMonthIndex];
            currentYearElement.textContent = currentYear.toString();

            // Render the calendar for the new month and year
            renderCalendar(currentMonthIndex, currentYear);
        }
    });

    document.getElementById('prevMonth')?.addEventListener('click', () => {
        if (currentMonthElement && currentYearElement) {
            let currentMonthIndex = months.indexOf(currentMonthElement.textContent ?? '');
            let currentYear = parseInt(currentYearElement.textContent ?? '0');

            // Go back to the previous month
            if (currentMonthIndex === 0) {
                currentMonthIndex = 11; // Wrap around to December
                currentYear -= 1; // Roll back the year
            } else {
                currentMonthIndex -= 1;
            }

            // Update the DOM elements with new values
            currentMonthElement.textContent = months[currentMonthIndex];
            currentYearElement.textContent = currentYear.toString();

            // Render the calendar for the new month and year
            renderCalendar(currentMonthIndex, currentYear);
        }
    });

    // Initial render for the current month and year
    renderCalendar(new Date().getMonth(), new Date().getFullYear());
</script>